var A=function(){var a=function(){this.pop={hasAside:!1,hasPop:!1},this.$=$,this.options={clickEvent:"ontouchstart"in window?"tap":"click"}};return a.prototype.register=function(a,b){this[a]=b},new a}(window.Zepto||jQuery);animUtil=function(a){var b={};return b.classes={empty:[["empty","empty"],["empty","empty"]],slide:[["slideLeftOut","slideLeftIn"],["slideRightOut","slideRightIn"]],cover:[["","slideLeftIn"],["slideRightOut",""]],slideUp:[["","slideUpIn"],["slideDownOut",""]],slideDown:[["","slideDownIn"],["slideUpOut",""]],popup:[["","scaleIn"],["scaleOut",""]],flip:[["slideLeftOut","flipOut"],["slideRightOut","flipIn"]]},b.addClass=function(c){a.extend(b.classes,c||{})},b.run=function(b,c,d){var b=a(b),e="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";return 0==b.length?void(d&&d()):"object"==typeof c?void b.animate(c,250,"linear",function(){d&&d()}):(c=(c||"empty")+" anim",void b.addClass(c).one(e,function(){b.removeClass(c),d&&d(),b.unbind(e)}))},b.css3=function(b,c,d){b=a(b);var e="webkitTransitionEnd otransitionend transitionend";b.addClass("comm_anim").css(c).one(e,function(){b.removeClass("comm_anim"),d&&d(),b.unbind(e)})},b.change=function(c,d,e,f){var g=a(c),h=a(d);if(g.length+h.length==0)return void(f&&f());var i=h.data("transition");if(!b.classes[i])return void(f&&f());var j=b.classes[i][e?1:0];b.run(g,j[0]),b.run(h,j[1],function(){f&&f()})},b}(window.Zepto||jQuery),function(a){var b={};b.provider=function(a,b){return a=(a||"").trim(),a.replace(/\$\{([^\}]*)\}/g,function(a,c){return b[c.trim()]||""})},A.register("util",b)}(A.$),function(a){var b={index:0},c={"default":["fadeIn","fadeOut"],top:["slideDownIn","slideUpOut"],bottom:["slideUpIn","slideDownOut"],center:["bounceIn","bounceOut"],left:["slideRightIn","slideLeftOut"],right:["slideLeftIn","slideRightOut"]},d=function(c){var d=b.index++,e={id:"__popup__"+d,html:"",pos:"default",css:{},isBlock:!1};if(a.extend(e,c),b[e.id])return b[e.id];var f=b[e.id]=this;a('<div data-refer="'+e.id+'" class="popup-mask"></div><div id="'+e.id+'" class="agile-popup"></div>').appendTo("body");var g=a("#"+e.id),h=a('[data-refer="'+e.id+'"]');g.data("block",e.isBlock),g.css(e.css),g.addClass(e.pos),g.html(e.html),h.on(A.options.clickEvent,function(){return e.isBlock?!1:(f.close(),!1)}),g.on(A.options.clickEvent,'[data-toggle="popup"]',function(){return f.close(),!1}),this.options=e,this.popup=g,this.mask=h,this._event={}};d.prototype.on=function(a,b){return this._event[a]?this._event[a].push(b):this._event[a]=[b],this},d.prototype.trigger=function(a,b){for(var c=this._event[a],d=0;d<(c||[]).length;d++)c[d].apply(this);return b&&b.apply(this),this},d.prototype.open=function(d){var e=this,f=this.popup,g=this.mask,h=this.options;if(g.hasClass("active"))return b[h.id];a("body").children(".popup-mask.active").removeClass("active"),g.addClass("active").show(),f.show();var i=f.height();"center"==h.pos&&f.css("margin-top","-"+i/2+"px");var j=c[h.pos];return j?(e._status="opening",animUtil.run(f,j[0],function(){e._status="opened"})):e._status="opened",this.trigger("popupopen"),d&&d.call(this),A.pop.hasPop=f,this};var e=function(b){var c=this.popup,d=this.mask;c.remove(),d.remove(),this.trigger("popupclose"),setTimeout(function(){b&&b()},200),$last=a("body").children(".popup-mask").last().addClass("active"),A.pop.hasPop=0==$last.length?!1:a("body").children(".agile-popup").last()};d.prototype.close=function(a){var b=this;setTimeout(function(){b._close(a)},100)},d.prototype._close=function(a){if("opening"!=this._status){this.trigger("popupbeforeclose");var d=this,f=this.popup,h=(this.mask,this.options),i=c[h.pos];i?animUtil.run(f,i[1],function(){e.call(d,a)}):e.call(d,a),delete b[h.id]}},A.register("Popup",d);var f={};f.popup=function(a){return b[a.id]?b[a.id]:new d(a).open()},f.closePopup=function(a){var c=A.pop.hasPop.attr("id");b[c]&&b[c].close(a)},f.alert=function(a,b,c){return b?"function"==typeof b&&(c=b,b=a,a="提示"):(b=a,a="提示"),new d({html:A.util.provider('<div class="popup-title">${title}</div><div class="popup-content">${content}</div><div class="popup-handler"><a data-toggle="popup" class="popup-handler-ok">${ok}</a></div>',{title:a,content:b,ok:"确定"}),pos:"center",isBlock:!0}).on("popupclose",function(){c&&c()}).open()},f.confirm=function(b,c,e,f){"function"==typeof c&&(f=e,e=c,c=b,b="提示");var g=e;return new d({html:A.util.provider('<div class="popup-title">${title}</div><div class="popup-content">${content}</div><div class="popup-handler"><a data-toggle="popup" class="popup-handler-cancel">${cancel}</a><a data-toggle="popup" class="popup-handler-ok">${ok}</a></div>',{title:b,content:c,cancel:"取消",ok:"确定"}),pos:"center",isBlock:!0}).on("popupclose",function(){g&&g.call(this)}).open(function(){var b=a(this.popup);b.find(".popup-handler-ok").on(A.options.clickEvent,function(){g=e}),b.find(".popup-handler-cancel").on(A.options.clickEvent,function(){g=f})})},f.showMask=function(a,b){return"function"==typeof a&&(b=a,a="加载中"),new d({id:"popup_loading",html:A.util.provider('<i class="popup-spinner"></i><p>${title}</p>',{title:a||"加载中"}),pos:"loading",isBlock:!0}).on("popupclose",function(){b&&b()}).open()},f.hideMask=function(a){b.popup_loading&&b.popup_loading.close()},f.actionsheet=function(b,c){var e=['<div class="actionsheet"><div class="actionsheet-group">'],f="popup-actionsheet-normal",g="popup-actionsheet-cancel",c=0==c?!1:c||!0;return a.each(b,function(a,b){e.push('<button data-toggle="popup" class="'+(b.css||f)+'">'+b.text+"</button>")}),e.push("</div>"),c&&e.push('<button data-toggle="popup" class="'+("string"==typeof c?c:g)+'">取消</button>'),e.push("</div>"),new d({html:e.join(""),pos:"bottom",css:{background:"transparent"}}).open(function(){a(this.popup).find("button").each(function(c,d){a(d).on(A.options.clickEvent,function(){b[c]&&b[c].handler&&b[c].handler.call(d)})})})},f.popover=function(b,c){var e=[];if(e.push('<div class="popover-angle"></div>'),"object"==typeof b){e.push('<ul class="popover-items">');for(var f=0;f<b.length;f++)e.push('<li data-toggle="popup" class="'+(b[f].css||"")+'">'+b[f].text+"</li>");e.push("</ul>")}else e.push(b);return new d({html:e.join("")}).on("popupopen",function(){var d=a(document),e=d.height(),f=d.width(),g=a(c),h=g.height(),i=g.width(),j=g.offset().top,k=g.offset().left,l=k+i/2,m=a(this.popup).addClass("popover"),n=a(m.find(".popover-angle").get(0)),o=n.height()/2,p=Math.ceil((n.width()-2)*Math.sqrt(2)),q=m.height(),r=m.width(),s=0>e-q-h&&j>q?"up":"down",t={},u={};"up"==s?(t.top=j-(q+o),u.bottom=-o+4):(t.top=j+(h+o),u.top=-o+4),t.left=l-r/2,t.left+r>=f-4?t.left=f-r-4:t.left<4&&(t.left=4),u.left=l-t.left-p/2,m.css(t),n.css(u),m.find(".popover-items li").each(function(c,d){a(d).on(A.options.clickEvent,function(){b[c]&&b[c].handler&&b[c].handler.call(d)})})}).open()};for(var g in f)A.register(g,f[g])}(A.$);